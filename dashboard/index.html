<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Central Park Squirrel Activity Dashboard</title>
    <link rel="stylesheet" href="style.css" />
    <script src="./d3.v7.min.js"></script>
    <script src="./selection.js"></script>
    <script src="./idioms/filters.js"></script>
    <script src="./idioms/linechart.js"></script>
    <script src="./idioms/butterflyChart.js"></script>
    <script src="./idioms/map.js"></script>
    <script src="./script.js"></script>
    <style>
        /* Popup Overlay */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .popup-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Popup Content */
        .popup-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }

        .popup-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .popup-header h2 {
            margin: 0;
            color: #333;
            font-size: 24px;
            font-weight: 600;
        }

        .popup-section {
            margin-bottom: 20px;
        }

        .popup-section h3 {
            color: #555;
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .popup-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .popup-section li {
            padding: 8px 0;
            color: #666;
            font-size: 15px;
            line-height: 1.5;
        }

        .popup-section li strong {
            color: #333;
            font-weight: 600;
        }

        .popup-close-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: background-color 0.2s ease;
        }

        .popup-close-btn:hover {
            background-color: #45a049;
        }

        .popup-close-btn:active {
            transform: scale(0.98);
        }
    </style>
  </head>

  <body onload="init()">
    <!-- Popup Overlay -->
    <div class="popup-overlay" id="instructionsPopup">
        <div class="popup-content">
            <div class="popup-header">
                <h2>Dashboard Interactions Guide</h2>
            </div>

            <div class="popup-section">
                <h3>Map Interactions</h3>
                <ul>
                    <li><strong>Press 'B':</strong> Toggle brush selection mode (crosshair cursor)</li>
                    <li><strong>Click + Drag:</strong> Pan the map (when brush mode is off)</li>
                    <li><strong>Trackpad/Scroll:</strong> Zoom in and out</li>
                    <li><strong>Click + Drag in Brush Mode:</strong> Select dots within area</li>
                    <li><strong>Hover over dots:</strong> View tooltip with squirrel details</li>
                </ul>
            </div>

            <div class="popup-section">
                <h3>Line Chart Interactions</h3>
                <ul>
                    <li><strong>Click + Drag:</strong> Brush to zoom into a specific time range (double-click to reset)</li>
                    <li><strong>Hover over lines:</strong> View tooltip with data values</li>
                </ul>
            </div>

            <div class="popup-section">
                <h3>All Visualizations</h3>
                <ul>
                    <li><strong>Click Legend Items:</strong> Filter/toggle data categories on and off</li>
                    <li><strong>Hover:</strong> View detailed tooltips for data points</li>
                </ul>
            </div>

            <button class="popup-close-btn" onclick="closePopup()">Got it! Let's explore</button>
        </div>
    </div>

    <div class="dashboard-container">
      <!-- Title Section -->
      <div class="title-section">
        <h1>SQUIRREL ACTIVITY DASHBOARD</h1>
        <h2>Central Park, NYC</h2>
      </div>
      
      <!-- Filter Bar Section -->
      <div class="filter-section">
        <div class="behavior-filters">
          <!-- Food Filter -->
          <div class="filter-dropdown">
            <button class="filter-btn" data-filter="food">Food ‚ñº</button>
            <div class="dropdown-content" data-category="food">
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="eating" data-column="Eating">
                <span>Eating</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="foraging" data-column="Foraging">
                <span>Foraging</span>
              </label>
            </div>
          </div>

          <!-- Movement Filter -->
          <div class="filter-dropdown">
            <button class="filter-btn" data-filter="movement">Movement ‚ñº</button>
            <div class="dropdown-content" data-category="movement">
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="running" data-column="Running">
                <span>Running</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="climbing" data-column="Climbing">
                <span>Climbing</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="chasing" data-column="Chasing">
                <span>Chasing</span>
              </label>
            </div>
          </div>

          <!-- Sound Filter -->
          <div class="filter-dropdown">
            <button class="filter-btn" data-filter="sound">Sound ‚ñº</button>
            <div class="dropdown-content" data-category="sound">
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="kuks" data-column="Kuks">
                <span>Kuks</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="quaas" data-column="Quaas">
                <span>Quaas</span>
              </label>
            </div>
          </div>

          <!-- Tail Filter -->
          <div class="filter-dropdown">
            <button class="filter-btn" data-filter="tail">Tail ‚ñº</button>
            <div class="dropdown-content" data-category="tail">
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="tail_flags" data-column="Tail flags">
                <span>Tail Flags</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="tail_twitches" data-column="Tail twitches">
                <span>Tail Twitches</span>
              </label>
            </div>
          </div>

          <!-- Human Interaction Filter -->
          <div class="filter-dropdown">
            <button class="filter-btn" data-filter="human">Human Interaction ‚ñº</button>
            <div class="dropdown-content" data-category="human">
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="approaches" data-column="Approaches">
                <span>Approaches</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="indifferent" data-column="Indifferent">
                <span>Indifferent</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="runs_from" data-column="Runs from">
                <span>Runs From</span>
              </label>
            </div>
          </div>

          <!-- Age Filter -->
          <div class="filter-dropdown">
            <button class="filter-btn" data-filter="age">Age ‚ñº</button>
            <div class="dropdown-content" data-category="age">
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="adult" data-column="Age" data-value="Adult">
                <span>Adult</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="juvenile" data-column="Age" data-value="Juvenile">
                <span>Juvenile</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" data-behavior="unknown" data-column="Age" data-value="Unknown">
                <span>Unknown</span>
              </label>
              
            </div>
          </div>
        </div>

        <div class="reset-filters">
          <button id="reset-filters-btn" title="Reset All Filters">Reset Filters</button>
        </div>
        
        <div class="dog-filter">
          <span class="label">Dog Activity</span>
          <div class="dog-toggle" data-dog="toggle" title="Toggle Dog Activity">
            <div class="dog-icon">üêï</div>
            <span class="toggle-text">Show Dogs</span>
          </div>
        </div>

        <div class="color-filters">
          <span class="label">Squirrel Color</span>
          <div class="color-options">
            <div class="color-option" data-color="gray">
              <img src="../images/grey-squirrel.png" alt="Gray squirrel" class="squirrel-icon">
            </div>
            <div class="color-option" data-color="cinnamon">
              <img src="../images/cinnamon-squirrel.png" alt="Cinnamon squirrel" class="squirrel-icon">
            </div>
            <div class="color-option" data-color="black">
              <img src="../images/black-squirrel.png" alt="Black squirrel" class="squirrel-icon">
            </div>
          </div>
        </div>
      </div>

      <!-- Main Dashboard Content -->
      <div class="dashboard-content">
        <!-- Map Section - Full Width -->
        <div class="map-section">
          <div class="Map"></div>
        </div>
        
        <!-- Bottom Charts Section - Side by Side -->
        <div class="bottom-charts">
          <!-- Butterfly Chart -->
          <div class="butterfly-section">
            <div style="position: relative; display: flex; justify-content: flex-end; align-items: center;">
              <!-- Title Container -->
              <h3 class="butterfly-title">Squirrel Activity by Fur Color & Time of Day</h3>

              <!-- Toggle -->
              <div class="toggle-container">
                  <span class="toggle-label left">Absolute</span>
                  <label class="switch">
                      <input type="checkbox" id="butterfly-scale-toggle" name="butterfly-scale-mode" autocomplete="off">
                      <span class="slider round"></span>
                  </label>
                  <span class="toggle-label right">%</span>
              </div>
          </div>
            <div class="ButterflyChart"></div>
          </div>
          
          <!-- Line Chart -->
          <div class="linechart-section">
            <h3>Squirrel Activity Across Temperature</h3>
            <div class="LineChart"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
        function closePopup() {
            const popup = document.getElementById('instructionsPopup');
            popup.classList.add('hidden');
            // Remove from DOM after animation
            setTimeout(() => {
                popup.style.display = 'none';
            }, 300);
        }

        // Optional: Close popup when clicking outside
        document.getElementById('instructionsPopup').addEventListener('click', function(e) {
            if (e.target === this) {
                closePopup();
            }
        });

        // Optional: Close popup with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closePopup();
            }
        });
    </script>

    <!-- Debug -->
     <script>
        console.log("Script tag executed")
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM Content Loaded - calling init()");
            init();
        })
     </script>

  </body>
</html>